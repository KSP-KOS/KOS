<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flow Control &mdash; kOS 0.15.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.15.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="kOS 0.15.3 documentation" href="../index.html" />
    <link rel="up" title="The KerboScript Language" href="../language.html" />
    <link rel="next" title="Variables &amp; Statements" href="variables.html" />
    <link rel="prev" title="KerboScript Syntax Specification" href="syntax.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="variables.html" title="Variables &amp; Statements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="syntax.html" title="KerboScript Syntax Specification"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">kOS 0.15.3 documentation</a> &raquo;</li>
          <li><a href="../language.html" accesskey="U">The <strong>KerboScript</strong> Language</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="flow-control">
<span id="flow"></span><h1>Flow Control<a class="headerlink" href="#flow-control" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#break" id="id9"><tt class="docutils literal"><span class="pre">BREAK</span></tt></a></li>
<li><a class="reference internal" href="#if-else" id="id10"><tt class="docutils literal"><span class="pre">IF</span></tt> / <tt class="docutils literal"><span class="pre">ELSE</span></tt></a></li>
<li><a class="reference internal" href="#lock" id="id11"><tt class="docutils literal"><span class="pre">LOCK</span></tt></a></li>
<li><a class="reference internal" href="#unlock" id="id12"><tt class="docutils literal"><span class="pre">UNLOCK</span></tt></a></li>
<li><a class="reference internal" href="#until" id="id13"><tt class="docutils literal"><span class="pre">UNTIL</span></tt></a></li>
<li><a class="reference internal" href="#for" id="id14"><tt class="docutils literal"><span class="pre">FOR</span></tt></a></li>
<li><a class="reference internal" href="#wait" id="id15"><tt class="docutils literal"><span class="pre">WAIT</span></tt></a></li>
<li><a class="reference internal" href="#when-then" id="id16"><tt class="docutils literal"><span class="pre">WHEN</span></tt> / <tt class="docutils literal"><span class="pre">THEN</span></tt></a></li>
<li><a class="reference internal" href="#on" id="id17"><tt class="docutils literal"><span class="pre">ON</span></tt></a></li>
<li><a class="reference internal" href="#preserve" id="id18"><tt class="docutils literal"><span class="pre">PRESERVE</span></tt></a></li>
<li><a class="reference internal" href="#boolean-operators" id="id19">Boolean Operators</a></li>
</ul>
</div>
<div class="section" id="break">
<span id="index-0"></span><span id="id1"></span><h2><a class="toc-backref" href="#id9"><tt class="docutils literal"><span class="pre">BREAK</span></tt></a><a class="headerlink" href="#break" title="Permalink to this headline">¶</a></h2>
<p>Breaks out of a loop:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">X</span> <span class="n">TO</span> <span class="mf">1.</span>
<span class="n">UNTIL</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="n">SET</span> <span class="n">X</span> <span class="n">TO</span> <span class="n">X</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="n">IF</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="n">BREAK</span><span class="p">.</span> <span class="p">}</span> <span class="c1">// Exits the loop when</span>
                         <span class="c1">// X is greater than 10</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="if-else">
<span id="if"></span><span id="index-1"></span><h2><a class="toc-backref" href="#id10"><tt class="docutils literal"><span class="pre">IF</span></tt> / <tt class="docutils literal"><span class="pre">ELSE</span></tt></a><a class="headerlink" href="#if-else" title="Permalink to this headline">¶</a></h2>
<p>Checks if the expression supplied returns true. If it does, <tt class="docutils literal"><span class="pre">IF</span></tt> executes the following command block. Can also have an optional <tt class="docutils literal"><span class="pre">ELSE</span></tt> to execute when the <tt class="docutils literal"><span class="pre">IF</span></tt> condition is not true. <tt class="docutils literal"><span class="pre">ELSE</span></tt> can have another <tt class="docutils literal"><span class="pre">IF</span></tt> after it, to make a chain of <tt class="docutils literal"><span class="pre">IF</span></tt>/<tt class="docutils literal"><span class="pre">ELSE</span></tt> conditions:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">X</span> <span class="n">TO</span> <span class="mf">1.</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X equals one.&quot;</span><span class="p">.</span> <span class="p">}</span>     <span class="c1">// Prints &quot;X equals one.&quot;</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X is greater than ten.&quot;</span><span class="p">.</span> <span class="p">}</span>  <span class="c1">// Does nothing</span>

<span class="c1">// IF-ELSE structure:</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X is large&quot;</span><span class="p">.</span>  <span class="p">}</span> <span class="n">ELSE</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X is small&quot;</span><span class="p">.</span>  <span class="p">}</span>

<span class="c1">// An if-else ladder:</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="n">PRINT</span> <span class="s">&quot;zero&quot;</span><span class="p">.</span>
<span class="p">}</span> <span class="n">ELSE</span> <span class="n">IF</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="n">PRINT</span> <span class="s">&quot;negative&quot;</span><span class="p">.</span>
<span class="p">}</span> <span class="n">ELSE</span> <span class="p">{</span>
    <span class="n">PRINT</span> <span class="s">&quot;positive&quot;</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The period (<tt class="docutils literal"><span class="pre">.</span></tt>) is optional after the end of a set of curly braces like so:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="c1">// both of these lines are fine</span>
<span class="n">IF</span> <span class="n">TRUE</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Hello&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">TRUE</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Hello&quot;</span><span class="p">.</span> <span class="p">}.</span>
</pre></div>
</div>
<p>In the case where you are using the <tt class="docutils literal"><span class="pre">ELSE</span></tt> keyword, you must <em>not</em> end the previous <tt class="docutils literal"><span class="pre">IF</span></tt> body with a period, as that terminates the <tt class="docutils literal"><span class="pre">IF</span></tt> command and causes the <tt class="docutils literal"><span class="pre">ELSE</span></tt> keyword to be without a matching <tt class="docutils literal"><span class="pre">IF</span></tt>:</p>
<div class="last highlight-c"><div class="highlight"><pre><span class="c1">// works:</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Large&quot;</span><span class="p">.</span> <span class="p">}</span>  <span class="n">ELSE</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Small&quot;</span><span class="p">.</span> <span class="p">}.</span>

<span class="c1">// syntax error - ELSE without IF.</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Large&quot;</span><span class="p">.</span> <span class="p">}.</span> <span class="n">ELSE</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Small&quot;</span><span class="p">.</span> <span class="p">}.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lock">
<span id="index-2"></span><span id="id2"></span><h2><a class="toc-backref" href="#id11"><tt class="docutils literal"><span class="pre">LOCK</span></tt></a><a class="headerlink" href="#lock" title="Permalink to this headline">¶</a></h2>
<p>Locks an identifier to an expression. Each time the identifier is used in an expression, its value will be re-calculated on the fly:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">X</span> <span class="n">TO</span> <span class="mf">1.</span>
<span class="n">LOCK</span> <span class="n">Y</span> <span class="n">TO</span> <span class="n">X</span> <span class="o">+</span> <span class="mf">2.</span>
<span class="n">PRINT</span> <span class="n">Y</span><span class="p">.</span>         <span class="c1">// Outputs 3</span>
<span class="n">SET</span> <span class="n">X</span> <span class="n">TO</span> <span class="mf">4.</span>
<span class="n">PRINT</span> <span class="n">Y</span><span class="p">.</span>         <span class="c1">// Outputs 6</span>
</pre></div>
</div>
<p>Unlike variables created with the <tt class="docutils literal"><span class="pre">SET</span></tt> or <tt class="docutils literal"><span class="pre">DECLARE</span></tt> commands, <tt class="docutils literal"><span class="pre">LOCK</span></tt> variables are local to the current program. If program <strong>A</strong> calls program <strong>B</strong>, and program <strong>B</strong> issues a <tt class="docutils literal"><span class="pre">LOCK</span></tt> command, program <strong>A</strong> will not be able to read that <tt class="docutils literal"><span class="pre">LOCK</span></tt> variable&#8217;s result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a <tt class="docutils literal"><span class="pre">LOCK</span></tt> expression is used with a flight control such as <tt class="docutils literal"><span class="pre">THROTTLE</span></tt> or <tt class="docutils literal"><span class="pre">STEERING</span></tt>, then it will get continually evaluated in the background <em class="xref std std-ref">each update tick</em>.</p>
</div>
</div>
<div class="section" id="unlock">
<span id="index-3"></span><span id="id3"></span><h2><a class="toc-backref" href="#id12"><tt class="docutils literal"><span class="pre">UNLOCK</span></tt></a><a class="headerlink" href="#unlock" title="Permalink to this headline">¶</a></h2>
<p>Releases a lock on a variable. See <tt class="docutils literal"><span class="pre">LOCK</span></tt>:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">UNLOCK</span> <span class="n">X</span><span class="p">.</span>    <span class="c1">// Releases a lock on variable X</span>
<span class="n">UNLOCK</span> <span class="n">ALL</span><span class="p">.</span>  <span class="c1">// Releases ALL locks</span>
</pre></div>
</div>
</div>
<div class="section" id="until">
<span id="index-4"></span><span id="id4"></span><h2><a class="toc-backref" href="#id13"><tt class="docutils literal"><span class="pre">UNTIL</span></tt></a><a class="headerlink" href="#until" title="Permalink to this headline">¶</a></h2>
<p>Performs a loop until a certain condition is met:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">X</span> <span class="n">to</span> <span class="mf">1.</span>
<span class="n">UNTIL</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span>      <span class="c1">// Prints the numbers 1-10</span>
    <span class="n">PRINT</span> <span class="n">X</span><span class="p">.</span>
    <span class="n">SET</span> <span class="n">X</span> <span class="n">to</span> <span class="n">X</span> <span class="o">+</span> <span class="mf">1.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that if you are creating a loop in which you are watching a physical value that you expect to change each iteration, it&#8217;s vital that you insert a small WAIT at the bottom of the loop like so:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">PREV_TIME</span> <span class="n">to</span> <span class="n">TIME</span><span class="o">:</span><span class="n">SECONDS</span><span class="p">.</span>
<span class="n">SET</span> <span class="n">PREV_VEL</span> <span class="n">to</span> <span class="n">SHIP</span><span class="o">:</span><span class="n">VELOCITY</span><span class="p">.</span>
<span class="n">SET</span> <span class="n">ACCEL</span> <span class="n">to</span> <span class="n">V</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">9999</span><span class="p">).</span>
<span class="n">PRINT</span> <span class="s">&quot;Waiting for accellerations to stop.&quot;</span><span class="p">.</span>
<span class="n">UNTIL</span> <span class="n">ACCEL</span><span class="o">:</span><span class="n">MAG</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="p">{</span>
    <span class="n">SET</span> <span class="n">ACCEL</span> <span class="n">TO</span> <span class="p">(</span><span class="n">SHIP</span><span class="o">:</span><span class="n">VELOCITY</span> <span class="o">-</span> <span class="n">PREV_VEL</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">TIME</span><span class="o">:</span><span class="n">SECONDS</span> <span class="o">-</span> <span class="n">PREV_TIME</span><span class="p">).</span>
    <span class="n">SET</span> <span class="n">PREV_TIME</span> <span class="n">to</span> <span class="n">TIME</span><span class="o">:</span><span class="n">SECONDS</span><span class="p">.</span>
    <span class="n">SET</span> <span class="n">PREV_VEL</span> <span class="n">to</span> <span class="n">SHIP</span><span class="o">:</span><span class="n">VELOCITY</span><span class="p">.</span>

    <span class="n">WAIT</span> <span class="mf">0.001</span><span class="p">.</span>  <span class="c1">// This line is Vitally Important.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The full explanation why is <em class="xref std std-ref">in the CPU hardware description
page</em>.</p>
</div>
<div class="section" id="for">
<span id="index-5"></span><span id="id5"></span><h2><a class="toc-backref" href="#id14"><tt class="docutils literal"><span class="pre">FOR</span></tt></a><a class="headerlink" href="#for" title="Permalink to this headline">¶</a></h2>
<p>Loops over a list collection, letting you access one element at a time. Syntax:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">FOR</span> <span class="n">variable1</span> <span class="n">IN</span> <span class="n">variable2</span> <span class="p">{</span> <span class="n">use</span> <span class="n">variable1</span> <span class="n">here</span><span class="p">.</span> <span class="p">}</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><cite>variable1</cite> is a variable to hold each element one at a time.</li>
<li><cite>varaible2</cite> is a LIST variable to iterate over.</li>
</ul>
<p>Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">PRINT</span> <span class="s">&quot;Counting flamed out engines:&quot;</span><span class="p">.</span>
<span class="n">SET</span> <span class="n">numOUT</span> <span class="n">to</span> <span class="mf">0.</span>
<span class="n">LIST</span> <span class="n">ENGINES</span> <span class="n">IN</span> <span class="n">MyList</span><span class="p">.</span>
<span class="n">FOR</span> <span class="n">eng</span> <span class="n">IN</span> <span class="n">MyList</span> <span class="p">{</span>
    <span class="n">IF</span> <span class="n">ENG</span><span class="o">:</span><span class="n">FLAMEOUT</span> <span class="p">{</span>
        <span class="n">set</span> <span class="n">numOUT</span> <span class="n">to</span> <span class="n">numOUT</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">PRINT</span> <span class="s">&quot;There are &quot;</span> <span class="o">+</span> <span class="n">numOut</span> <span class="o">+</span> <span class="s">&quot;Flamed out engines.&quot;</span><span class="p">.</span>
</pre></div>
</div>
</div>
<div class="section" id="wait">
<span id="index-6"></span><span id="id6"></span><h2><a class="toc-backref" href="#id15"><tt class="docutils literal"><span class="pre">WAIT</span></tt></a><a class="headerlink" href="#wait" title="Permalink to this headline">¶</a></h2>
<p>Halts execution for a specified amount of time, or until a specific set of criteria are met. Note that running a <tt class="docutils literal"><span class="pre">WAIT</span> <span class="pre">UNTIL</span></tt> statement can hang the machine forever if the criteria are never met. Examples:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">WAIT</span> <span class="mf">6.2</span><span class="p">.</span>                     <span class="c1">// Wait 6.2 seconds</span>
<span class="n">WAIT</span> <span class="n">UNTIL</span> <span class="n">X</span> <span class="o">&gt;</span> <span class="mf">40.</span>            <span class="c1">// Wait until X is greater than 40</span>
<span class="n">WAIT</span> <span class="n">UNTIL</span> <span class="n">APOAPSIS</span> <span class="o">&gt;</span> <span class="mf">150000.</span> <span class="c1">// You can see where this is going</span>
</pre></div>
</div>
<p>Note that any <tt class="docutils literal"><span class="pre">WAIT</span></tt> statement, no matter what the actual expression is, will always result in a wait time that lasts at least <em class="xref std std-ref">one physics tick</em>.</p>
</div>
<div class="section" id="when-then">
<span id="when"></span><span id="index-7"></span><h2><a class="toc-backref" href="#id16"><tt class="docutils literal"><span class="pre">WHEN</span></tt> / <tt class="docutils literal"><span class="pre">THEN</span></tt></a><a class="headerlink" href="#when-then" title="Permalink to this headline">¶</a></h2>
<p>Executes a command when a certain criteria are met. Unlike <tt class="docutils literal"><span class="pre">WAIT</span></tt>, <tt class="docutils literal"><span class="pre">WHEN</span></tt>
does not halt execution. It starts a check in the background that will keep actively looking for the trigger condition while the rest of the code continues. When it triggers, the body after the <tt class="docutils literal"><span class="pre">THEN</span></tt> will execute exactly once, after which the trigger is removed unless the <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> is used, in which case the trigger is not removed.</p>
<p>The body of a <tt class="docutils literal"><span class="pre">THEN</span></tt> or an <tt class="docutils literal"><span class="pre">ON</span></tt> statement interrupts the normal flow of a <strong>kOS</strong> program. When the event that triggers the body happens, the main <strong>kOS</strong> program is paused until the body of the <tt class="docutils literal"><span class="pre">THEN</span></tt> completes.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not make the body of a <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> take a long time to execute. If you attempt to run code that lasts too long in the body of your <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> statement, <em class="xref std std-ref">it will cause an error</em>. Avoid looping during <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> if you can. For details on how to deal with this, see the <a class="reference internal" href="../tutorials/designpatterns.html#designpatterns"><em>tutorial on design patterns</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="last versionchanged">
<p><span class="versionmodified">Changed in version 0.12: </span><strong>IMPORTANT BREAKING CHANGE:</strong> In previous versions of <strong>kOS</strong>, the body of a <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> would execute simultaneously in the background with the rest of the main program. This behavior has changed as of version <em>0.12</em> of <strong>kOS</strong>, as described above, and scripts that used to rely on this behavior will not work with version <em>0.12</em> of <strong>kOS</strong></p>
</div>
</div>
<p>Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">WHEN</span> <span class="n">BCount</span> <span class="o">&lt;</span> <span class="mi">99</span> <span class="n">THEN</span> <span class="n">PRINT</span> <span class="n">BCount</span> <span class="o">+</span> <span class="s">&quot; bottles of beer on the wall”.</span>

<span class="c1">// Watch in the background for when the altitude is high enough.</span>
<span class="c1">// Once it is, then turn on the solar panels and action group 1</span>
<span class="n">WHEN</span> <span class="n">altitude</span> <span class="o">&gt;</span> <span class="mi">70000</span> <span class="n">THEN</span> <span class="p">{</span>
    <span class="n">PRINT</span> <span class="s">&quot;ACTIVATING PANELS AND AG 1.&quot;</span><span class="p">.</span>
    <span class="n">PANELS</span> <span class="n">ON</span><span class="p">.</span>
    <span class="n">AG1</span> <span class="n">ON</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> trigger is removed when the program that created it exits, even if it has not occurred yet. The <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> can be used inside the <tt class="docutils literal"><span class="pre">THEN</span></tt> clause of a <tt class="docutils literal"><span class="pre">WHEN</span></tt> statement. If you are going to make extensive use of <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> triggers, it&#8217;s important to understand more details of how they <em class="xref std std-ref">work in the kOS CPU</em>.</p>
</div>
<div class="section" id="on">
<span id="index-8"></span><span id="id7"></span><h2><a class="toc-backref" href="#id17"><tt class="docutils literal"><span class="pre">ON</span></tt></a><a class="headerlink" href="#on" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">ON</span></tt> command is almost identical to the <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> command. <tt class="docutils literal"><span class="pre">ON</span></tt> sets up a trigger in the background that will run the selected command exactly once when the boolean variable changes state from true to false or from false to true. This command is best used to listen for action group activations.</p>
<p>Just like with the <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> command, the <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> command can be used inside the code block to cause the trigger to remain active and not go away.</p>
<p>How does it differ from <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt>? The <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> triggers are executed whenever the conditional expression <em>becomes true</em>. <tt class="docutils literal"><span class="pre">ON</span></tt> triggers are executed whenever the boolean variable <em>changes state</em> either from false to true or from true to false.</p>
<p>The body of an <tt class="docutils literal"><span class="pre">ON</span></tt> statement can be a list of commands inside curly braces, just like for <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt>. Also just like with <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt>, the body of the <tt class="docutils literal"><span class="pre">ON</span></tt> interrupts all of <strong>KSP</strong> while it runs, so it should be designed to be a short and finish quickly without getting stuck in a long loop:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">ON</span> <span class="n">AG3</span> <span class="p">{</span>
   <span class="n">PRINT</span> <span class="s">&quot;Action Group 3 Activated!”.</span>
<span class="p">}</span>
<span class="n">ON</span> <span class="n">SAS</span> <span class="n">PRINT</span> <span class="s">&quot;SAS system has been toggled”.</span>
<span class="n">ON</span> <span class="n">AG1</span> <span class="p">{</span>
    <span class="n">PRINT</span> <span class="s">&quot;Action Group 1 activated.&quot;</span><span class="p">.</span>
    <span class="n">PRESERVE</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">DO NOT make the body of an <tt class="docutils literal"><span class="pre">ON</span></tt> statement take a long time to execute. If you attempt to run code that lasts too long in the body of your <tt class="docutils literal"><span class="pre">ON</span></tt> statement, <em class="xref std std-ref">it will cause an error</em>. For general help on how to deal with this, see the <a class="reference internal" href="../tutorials/designpatterns.html#designpatterns"><em>tutorial on design patterns</em></a>.</p>
</div>
<p>Avoid looping during <tt class="docutils literal"><span class="pre">ON</span></tt> code blocks if you can. If you are going to make extensive use of <tt class="docutils literal"><span class="pre">ON</span></tt> triggers, it&#8217;s important to understand more details of how they <em class="xref std std-ref">work in the kOS CPU</em>.</p>
</div>
<div class="section" id="preserve">
<span id="index-9"></span><span id="id8"></span><h2><a class="toc-backref" href="#id18"><tt class="docutils literal"><span class="pre">PRESERVE</span></tt></a><a class="headerlink" href="#preserve" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">PRESERVE</span></tt> is a command keyword that is only valid inside of <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> and <tt class="docutils literal"><span class="pre">ON</span></tt> code blocks.</p>
<p>When a <tt class="docutils literal"><span class="pre">WHEN</span></tt>/<tt class="docutils literal"><span class="pre">THEN</span></tt> or <tt class="docutils literal"><span class="pre">ON</span></tt> condition is triggered, the default behavior is to execute the code block body exactly once and only once, and then the trigger condition is removed and the trigger will never occur again.</p>
<p>To alter this, execute the <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> command anywhere within the body of the code being executed and it tells the <strong>kOS</strong> computer to keep the trigger condition active. When it finishes executing the code block of the trigger, if <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> has happened anywhere within that run of the block of code, it will not remove the trigger. Instead it will allow it to re-trigger, possibly as soon as the very next tick. If the <tt class="docutils literal"><span class="pre">PRESERVE</span></tt> keyword is executed again and again each time the trigger occurs, the trigger could remain active indefinitely.</p>
<p>The following example sets up a continuous background check to keep looking for if there&#8217;s no fuel in the current stage, and if there is, then it activates the next stage, but no more often than once every half second. Once more than <tt class="docutils literal"><span class="pre">NUMSTAGES</span></tt> have happened, it allows the check to stop executing but it keeps the check alive until that happens:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SET</span> <span class="n">NUMSTAGES</span> <span class="n">TO</span> <span class="mf">5.</span>
<span class="n">SET</span> <span class="n">COOLDOWN_START</span> <span class="n">TO</span> <span class="mf">0.</span>

<span class="n">WHEN</span> <span class="p">(</span><span class="n">TIME</span><span class="o">:</span><span class="n">SECONDS</span> <span class="o">&gt;</span> <span class="n">COOLDOWN_START</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">STAGE</span><span class="o">:</span><span class="n">LIQUIDFUEL</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="n">SET</span> <span class="n">COOLDOWN_START</span> <span class="n">TO</span> <span class="n">TIME</span><span class="o">:</span><span class="n">SECONDS</span><span class="p">.</span>
    <span class="n">STAGE</span><span class="p">.</span>
    <span class="n">SET</span> <span class="n">NUMSTAGES</span> <span class="n">TO</span> <span class="n">NUMSTAGES</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="n">IF</span> <span class="n">NUMSTAGES</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">PRESERVE</span><span class="p">.</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Continue to the rest of the code</span>
</pre></div>
</div>
</div>
<div class="section" id="boolean-operators">
<span id="booleans"></span><span id="index-10"></span><h2><a class="toc-backref" href="#id19">Boolean Operators</a><a class="headerlink" href="#boolean-operators" title="Permalink to this headline">¶</a></h2>
<p>All conditional statements, like <tt class="docutils literal"><span class="pre">IF</span></tt>, can make use of boolean operators. The order of operations is as follows:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">=</span></tt> <tt class="docutils literal"><span class="pre">&lt;</span></tt> <tt class="docutils literal"><span class="pre">&gt;</span></tt> <tt class="docutils literal"><span class="pre">&lt;=</span></tt> <tt class="docutils literal"><span class="pre">&gt;=</span></tt> <tt class="docutils literal"><span class="pre">&lt;&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">AND</span></tt></li>
<li><tt class="docutils literal"><span class="pre">OR</span></tt></li>
<li><tt class="docutils literal"><span class="pre">NOT</span></tt></li>
</ul>
<p>Boolean is a type that can be stored in a variable and used that way as well. The constants <tt class="docutils literal"><span class="pre">True</span></tt> and <tt class="docutils literal"><span class="pre">False</span></tt> (case insensitive) may be used as values for boolean variables. If a number is used as if it was a Boolean variable, it will be interpreted in the standard way (zero means false, anything else means true):</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">IF</span> <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">AND</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Both conditions are true&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">OR</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;At least one condition is true&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">or</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;Neither condition is true&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">X</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X is not 1&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">SET</span> <span class="n">MYCHECK</span> <span class="n">TO</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">or</span> <span class="n">Y</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">).</span>
<span class="n">IF</span> <span class="n">MYCHECK</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;mycheck is true.&quot;</span> <span class="p">}</span>
<span class="n">LOCK</span> <span class="n">CONTINUOUSCHECK</span> <span class="n">TO</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="mf">0.</span>
<span class="n">WHEN</span> <span class="n">CONTINUOUSCHECK</span> <span class="n">THEN</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;X has just become negative.&quot;</span><span class="p">.</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">True</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;This statement happens unconditionally.&quot;</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">False</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;This statement never happens.&quot;</span> <span class="p">}</span>
<span class="n">IF</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;This statement happens unconditionally.&quot;</span> <span class="p">}</span>
<span class="n">IF</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;This statement never happens.&quot;</span> <span class="p">}</span>
<span class="n">IF</span> <span class="n">count</span> <span class="p">{</span> <span class="n">PRINT</span> <span class="s">&quot;count isn&#39;t zero.&quot;</span><span class="p">.</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Flow Control</a><ul>
<li><a class="reference internal" href="#break"><tt class="docutils literal"><span class="pre">BREAK</span></tt></a></li>
<li><a class="reference internal" href="#if-else"><tt class="docutils literal"><span class="pre">IF</span></tt> / <tt class="docutils literal"><span class="pre">ELSE</span></tt></a></li>
<li><a class="reference internal" href="#lock"><tt class="docutils literal"><span class="pre">LOCK</span></tt></a></li>
<li><a class="reference internal" href="#unlock"><tt class="docutils literal"><span class="pre">UNLOCK</span></tt></a></li>
<li><a class="reference internal" href="#until"><tt class="docutils literal"><span class="pre">UNTIL</span></tt></a></li>
<li><a class="reference internal" href="#for"><tt class="docutils literal"><span class="pre">FOR</span></tt></a></li>
<li><a class="reference internal" href="#wait"><tt class="docutils literal"><span class="pre">WAIT</span></tt></a></li>
<li><a class="reference internal" href="#when-then"><tt class="docutils literal"><span class="pre">WHEN</span></tt> / <tt class="docutils literal"><span class="pre">THEN</span></tt></a></li>
<li><a class="reference internal" href="#on"><tt class="docutils literal"><span class="pre">ON</span></tt></a></li>
<li><a class="reference internal" href="#preserve"><tt class="docutils literal"><span class="pre">PRESERVE</span></tt></a></li>
<li><a class="reference internal" href="#boolean-operators">Boolean Operators</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="syntax.html"
                        title="previous chapter"><strong>KerboScript</strong> Syntax Specification</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="variables.html"
                        title="next chapter">Variables &amp; Statements</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/language/flow.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="variables.html" title="Variables &amp; Statements"
             >next</a> |</li>
        <li class="right" >
          <a href="syntax.html" title="KerboScript Syntax Specification"
             >previous</a> |</li>
        <li><a href="../index.html">kOS 0.15.3 documentation</a> &raquo;</li>
          <li><a href="../language.html" >The <strong>KerboScript</strong> Language</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Dunbaratu, erendrake, Originally By Nivekk.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>