

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>KerboScript Machine Code &mdash; kOS 0.15.3 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
    <link rel="top" title="kOS 0.15.3 documentation" href="../index.html"/>
        <link rel="up" title="General Topics" href="../general.html"/>
        <link rel="next" title="The Name Tag System" href="nametag.html"/>
        <link rel="prev" title="Files and Volumes" href="volumes.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> kOS</a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/quickstart.html">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/designpatterns.html">Design Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/pidloops.html">PID Loops</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../general.html">General</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cpu_vessel.html">CPU Vessel (SHIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_hardware.html">CPU Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="applauncher_panel.html">Launcher Panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="volumes.html">Files &amp; Volumes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Machine Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="nametag.html">Name Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="parts_and_partmodules.html">Parts &amp; PartModules</a></li>
<li class="toctree-l2"><a class="reference internal" href="comm_range.html">Communication Range</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../language/features.html">General Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../language/syntax.html">Language Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../language/flow.html">Flow Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../language/variables.html">Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../math.html">Mathematics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../math/basic.html">Fundamental Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/basic.html#mathematical-functions">Mathematical Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/vector.html">Vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/direction.html">Directions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/geocoordinates.html">Geographic Coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/ref_frame.html">Reference Frames</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/flight.html">Flight Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/prediction.html">Prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/list.html">Listing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/parts.html">Parts Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/files.html">File I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/terminal.html">Terminal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../structures.html">Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../structures/orbits.html">Orbits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../structures/celestial_bodies.html">Celestial Bodies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../structures/vessels.html">Vessels &amp; Parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../structures/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribute</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">kOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../general.html">General Topics</a> &raquo;</li>
      
    <li>KerboScript Machine Code</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/general/compiling.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="kerboscript-machine-code">
<span id="compiling"></span><h1>KerboScript Machine Code<a class="headerlink" href="#kerboscript-machine-code" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#compiling-to-a-ksm-file" id="id1">Compiling to a KSM File</a></li>
<li><a class="reference internal" href="#how-to-use-ksm-files" id="id2">How to Use KSM Files</a></li>
<li><a class="reference internal" href="#default-file-naming-conventions" id="id3">Default File Naming Conventions</a></li>
<li><a class="reference internal" href="#downsides-to-using-ksm-files" id="id4">Downsides to Using KSM Files</a></li>
<li><a class="reference internal" href="#more-reading-and-fiddling-with-your-bits" id="id5">More Reading and Fiddling with Your Bits</a></li>
</ul>
</div>
<div class="section" id="compiling-to-a-ksm-file">
<h2><a class="toc-backref" href="#id1">Compiling to a KSM File</a><a class="headerlink" href="#compiling-to-a-ksm-file" title="Permalink to this headline">¶</a></h2>
<p>When you run your Kerboscript programs, behind the scenes they get compiled into a form in memory that runs much smoother but at the same time is quite hard for a Kerbal to read and understand. The actual computer hardware built by your friends at Compotronix incorporated actually run the program using these tiny instructions called &#8220;opcodes&#8221;. In the early days of room-sized computers before we were able to get them down to the compact size of just a meter or so across, all programmers had to use this difficult system, referred to as &#8220;machine language&#8221;. Ah, those were heady days, but they were hard.</p>
<p>The commands you actually write when you say something like <tt class="docutils literal"><span class="pre">SET</span> <span class="pre">X</span> <span class="pre">TO</span> <span class="pre">1.0.</span></tt> are really a euphemism for these &#8220;machine language&#8221; opcodes under the surface.</p>
<p>When you try to &#8220;RUN&#8221; your script, the first thing that kOS does is transform your script into this ancient and arcane &#8220;machine language&#8221; form, storing it in its memory, and from then on it runs using that.</p>
<p>This process of transforming your script into Machine Language, or &#8220;ML&#8221; is called &#8220;Compiling&#8221;.</p>
<p>The &#8220;RUN&#8221; command does this silently, without telling you. This is why you may have noticed the universe slightly stutter for a moment when you first run your program. Compiling is hard work for the universe to do.</p>
<div class="section" id="why-do-i-care">
<h3>Why Do I Care?<a class="headerlink" href="#why-do-i-care" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an experimental feature.</p>
</div>
<p>The reason it matters is this: Although once it&#8217;s loaded into memory and running, these opcodes actually have a lot of baggage and take up a lot of space, when they&#8217;re stored passively on the disk not doing anything, they can be smaller than your script programs are. For one thing, they don&#8217;t care about your comments (only other Kerbals reading your script do), and they don&#8217;t care about your indenting (only other Kerbals reading your script do).</p>
<p>So, given that the compiled &#8220;ML&#8221; codes are the only thing your program really needs to be run, why not just store THAT instead of storing the entire script, and then you can put the ML files on your remote probes instead of putting the larger script files on them.</p>
<p>And THAT is the purpose of the COMPILE command.</p>
<p>It does some, but not all, of the compiling work that the RUN command does, and then stores the results in a file that you can run instead of running the original script.</p>
<p>The output of the COMPILE command is a file in what we call KSM format.</p>
<p>KSM stands for &#8220;KerboScript Machine code&#8221;, and it has nearly the same information the program will have when it&#8217;s loaded and running, minus a few extra steps about relocating it in memory.</p>
</div>
</div>
<div class="section" id="how-to-use-ksm-files">
<h2><a class="toc-backref" href="#id2">How to Use KSM Files</a><a class="headerlink" href="#how-to-use-ksm-files" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say that you have 3 programs your probe needs, called:</p>
<ul class="simple">
<li>myprog1.ks</li>
<li>myprog2.ks</li>
<li>myprog3.ks</li>
</ul>
<p>And that myprog1 calls myprog2 and myprog3, and you normall would call the progam this way:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SWITCH</span> <span class="n">TO</span> <span class="mf">1.</span>
<span class="n">COPY</span> <span class="n">myprog1</span> <span class="n">from</span> <span class="n">ARCHIVE</span><span class="p">.</span>
<span class="n">COPY</span> <span class="n">myprog2</span> <span class="n">from</span> <span class="n">ARCHIVE</span><span class="p">.</span>
<span class="n">COPY</span> <span class="n">myprog3</span> <span class="n">from</span> <span class="n">ARCHIVE</span><span class="p">.</span>
<span class="n">RUN</span> <span class="n">myprog1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;hello&quot;</span><span class="p">).</span>
</pre></div>
</div>
<p>Then you can put just the compiled KSM versions of them on your vessel and run it this way:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">SWITCH</span> <span class="n">TO</span> <span class="n">ARCHIVE</span><span class="p">.</span>

<span class="n">COMPILE</span> <span class="n">myprog1</span><span class="p">.</span><span class="n">ks</span> <span class="n">to</span> <span class="n">myprog1</span><span class="p">.</span><span class="n">ksm</span><span class="p">.</span>
<span class="n">COPY</span> <span class="n">myprog1</span><span class="p">.</span><span class="n">ksm</span> <span class="n">to</span> <span class="mf">1.</span>

<span class="n">COMPILE</span> <span class="n">myprog2</span><span class="p">.</span> <span class="c1">// If you leave the arguments off, it assumes you are going from .ks to .ksm</span>
<span class="n">COPY</span> <span class="n">myprog2</span><span class="p">.</span><span class="n">ksm</span> <span class="n">to</span> <span class="mf">1.</span>

<span class="n">COMPILE</span> <span class="n">myprog3</span><span class="p">.</span> <span class="c1">// If you leave the arguments off, it assumes you are going from .ks to .ksm</span>
<span class="n">COPY</span> <span class="n">myprog2</span><span class="p">.</span><span class="n">ksm</span> <span class="n">to</span> <span class="mf">1.</span>

<span class="n">SWITCH</span> <span class="n">TO</span> <span class="mf">1.</span>
<span class="n">RUN</span> <span class="n">myprog1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;hello&quot;</span><span class="p">).</span>
</pre></div>
</div>
</div>
<div class="section" id="default-file-naming-conventions">
<h2><a class="toc-backref" href="#id3">Default File Naming Conventions</a><a class="headerlink" href="#default-file-naming-conventions" title="Permalink to this headline">¶</a></h2>
<p>When you have both a .ks and a .ksm file, the RUN command allows you to specify which one you meant explicitly, like so:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">RUN</span> <span class="n">myprog1</span><span class="p">.</span><span class="n">ks</span><span class="p">.</span>
<span class="n">RUM</span> <span class="n">myprog1</span><span class="p">.</span><span class="n">ksm</span><span class="p">.</span>
</pre></div>
</div>
<p>But if you just leave the file extension off, and do this:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">RUN</span> <span class="n">myprog1</span><span class="p">.</span>
</pre></div>
</div>
<p>Then the RUN command will first try to run a file called &#8220;myprog1.ksm&#8221; and if it cannot find such a file, then it will try to run one called &#8220;myprog1.ks&#8221;.</p>
<p>In this way, if you decide to take the plunge and attempt the use of KSM files, you shouldn&#8217;t have to change the way any of your scripts call each other, provided you just used versions of the filenames without mentioning the file extensions.</p>
</div>
<div class="section" id="downsides-to-using-ksm-files">
<h2><a class="toc-backref" href="#id4">Downsides to Using KSM Files</a><a class="headerlink" href="#downsides-to-using-ksm-files" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Be aware that if you use this feature, you do lose the ability to have the line of code printed out for you when the kOS computer finds an error in your program. It will still tell you what line number the error happened on, but it cannot show you the line of code. Just the number.</li>
<li>Know that you cannot view the program inside the in-game editor anymore when you do this. A KSM file will not appear right in the editor. It requires a magic tool called a &#8220;hex editor&#8221; to properly see what&#8217;s happening inside the file.</li>
<li><strong>The file isn&#8217;t always smaller</strong>. There&#8217;s a threshold at which the KSM file is actually bigger than the source KS file. For large KS files, the KSM file will be smaller, but for short KS files, the KSM file will be bigger, because there&#8217;s a small amount of overhead they have to store that is only efficient if the data was large enough.</li>
</ol>
</div>
<div class="section" id="more-reading-and-fiddling-with-your-bits">
<h2><a class="toc-backref" href="#id5">More Reading and Fiddling with Your Bits</a><a class="headerlink" href="#more-reading-and-fiddling-with-your-bits" title="Permalink to this headline">¶</a></h2>
<p>So, if you are intrigued by all this and want to see how it all <em>REALLY</em> works under the hood, Computronix has deciced to make <a class="reference external" href="https://github.com/KSP-KOS/KOS/blob/develop/src/kOS.Safe/Compilation/CompiledObject-doc.md">internal document MLfile-zx1/a</a> on the basic plan of the ML file system open for public viewing, if you are one of those rare Kerbals that enjoys fiddling with your bits. No, not THOSE kind of bits, the computery kind!</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nametag.html" class="btn btn-neutral float-right" title="The Name Tag System">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="volumes.html" class="btn btn-neutral" title="Files and Volumes"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Dunbaratu, erendrake, Originally By Nivekk.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.15.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>